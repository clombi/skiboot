
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>OPAL_PCI_SET_PHB_CAPI_MODE &#8212; skiboot v6.2-1-g06ef9bd2d9a6
 documentation</title>
    <link rel="stylesheet" href="../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="OPAL_PCI_SET_PHB_MEM_WINDOW" href="opal-pci-set-phb-mem-window-28.html" />
    <link rel="prev" title="OPAL_PCI_SET_PELTV" href="opal-pci-set-peltv-32.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="opal-pci-set-phb-mem-window-28.html" title="OPAL_PCI_SET_PHB_MEM_WINDOW"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="opal-pci-set-peltv-32.html" title="OPAL_PCI_SET_PELTV"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">skiboot v6.2-1-g06ef9bd2d9a6
 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">OPAL API Documentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="opal-pci-set-phb-capi-mode">
<h1>OPAL_PCI_SET_PHB_CAPI_MODE<a class="headerlink" href="#opal-pci-set-phb-capi-mode" title="Permalink to this headline">¶</a></h1>
<p>Switch the CAPP attached to the given PHB in one of the supported CAPI modes</p>
<div class="section" id="parameters">
<h2>Parameters<a class="headerlink" href="#parameters" title="Permalink to this headline">¶</a></h2>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">uint64_t</span> <span class="pre">phb_id</span></code></dt>
<dd>the ID of the PHB which identifies attached CAPP to perform mode switch on</dd>
<dt><code class="docutils literal notranslate"><span class="pre">uint64_t</span> <span class="pre">mode</span></code></dt>
<dd>A mode id as described below</dd>
<dt><code class="docutils literal notranslate"><span class="pre">pe_number</span></code></dt>
<dd>PE number for the initiating device</dd>
</dl>
</div>
<div class="section" id="calling">
<h2>Calling<a class="headerlink" href="#calling" title="Permalink to this headline">¶</a></h2>
<p>Switch CAPP attached to the given PHB in one of the following supported modes:</p>
<p>OPAL_PHB_CAPI_MODE_PCIE         = 0
OPAL_PHB_CAPI_MODE_CAPI         = 1
OPAL_PHB_CAPI_MODE_SNOOP_OFF    = 2
OPAL_PHB_CAPI_MODE_SNOOP_ON     = 3
OPAL_PHB_CAPI_MODE_DMA          = 4
OPAL_PHB_CAPI_MODE_DMA_TVT1     = 5</p>
<p>Modes <cite>OPAL_PHB_CAPI_MODE_PCIE</cite> and <cite>OPAL_PHB_CAPI_MODE_CAPI</cite> are used to
enable/disable CAPP attached to the PHB.</p>
<p>Modes <cite>OPAL_PHB_CAPI_MODE_SNOOP_OFF</cite> and <cite>OPAL_PHB_CAPI_MODE_SNOOP_ON</cite> are
used to enable/disable CAPP snooping of Powerbus traffic for cache line
invalidates.</p>
<p>Mode <cite>OPAL_PHB_CAPI_MODE_DMA</cite> and <cite>OPAL_PHB_CAPI_MODE_DMA_TVT1</cite> are used to
enable CAPP DMA mode.</p>
<p>Presently Mode <cite>OPAL_PHB_CAPI_MODE_DMA_TVT1</cite> is exclusively used by the Mellanox
CX5 adapter. Requesting this mode will also indicate to opal that the card
requests maximum number of DMA read engines allocated to improve DMA read
performance at cost of reduced bandwidth available to other traffic including
CAPP-PSL transactions.</p>
</div>
<div class="section" id="notes">
<h2>Notes:<a class="headerlink" href="#notes" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>If PHB is in PEC2 then requesting mode <cite>OPAL_PHB_CAPI_MODE_DMA_TVT1</cite> will
allocate extra 16/8 dma read engines to the PHB depending on its stack
(stack 0/ stack 1). This is needed to improve the Direct-GPU DMA read
performance for the Mellanox CX5 card.</li>
<li>Mode <cite>OPAL_PHB_CAPI_MODE_PCIE</cite> not yet supported on Power-9.</li>
<li>Requesting mode <cite>OPAL_PHB_CAPI_MODE_CAPI</cite> on Power-9 will disable fast-reboot.</li>
<li>Modes <cite>OPAL_PHB_CAPI_MODE_DMA</cite>, <cite>OPAL_PHB_CAPI_MODE_SNOOP_OFF</cite> are
not supported on Power-9 yet.</li>
</ul>
</div>
<div class="section" id="return-codes">
<h2>Return Codes<a class="headerlink" href="#return-codes" title="Permalink to this headline">¶</a></h2>
<dl class="docutils">
<dt>OPAL_SUCCESS</dt>
<dd>Switch to the requested capi mode performed successfully.</dd>
<dt>OPAL_PARAMETER</dt>
<dd>The requested value of mode or phb_id parameter is not valid.</dd>
<dt>OPAL_HARDWARE</dt>
<dd>An error occurred while switching the CAPP to requested mode.</dd>
<dt>OPAL_UNSUPPORTED</dt>
<dd>Switching to requested capi mode is not possible at the moment</dd>
<dt>OPAL_RESOURCE</dt>
<dd>CAPP ucode not available hence activating CAPP not supported.</dd>
<dt>OPAL_BUSY</dt>
<dd>CAPP is presently in recovery-mode and mode switch cannot be performed.</dd>
</dl>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">OPAL_PCI_SET_PHB_CAPI_MODE</a><ul>
<li><a class="reference internal" href="#parameters">Parameters</a></li>
<li><a class="reference internal" href="#calling">Calling</a></li>
<li><a class="reference internal" href="#notes">Notes:</a></li>
<li><a class="reference internal" href="#return-codes">Return Codes</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="opal-pci-set-peltv-32.html"
                        title="previous chapter">OPAL_PCI_SET_PELTV</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="opal-pci-set-phb-mem-window-28.html"
                        title="next chapter">OPAL_PCI_SET_PHB_MEM_WINDOW</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/opal-api/opal-pci-set-phb-capi-mode-93.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="opal-pci-set-phb-mem-window-28.html" title="OPAL_PCI_SET_PHB_MEM_WINDOW"
             >next</a> |</li>
        <li class="right" >
          <a href="opal-pci-set-peltv-32.html" title="OPAL_PCI_SET_PELTV"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">skiboot v6.2-1-g06ef9bd2d9a6
 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >OPAL API Documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2016-2017, IBM, others.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.6.
    </div>
  </body>
</html>